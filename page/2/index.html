<!DOCTYPE html><html style="height:100%" class="jsx-3241352696"><head><meta charSet="utf-8" class="next-head"/><title class="next-head">Next-blog</title><link rel="preload" href="/next-blog/_next/static/CA1RmOMAWSlZaodAgWHti/pages/page.js" as="script"/><link rel="preload" href="/next-blog/_next/static/CA1RmOMAWSlZaodAgWHti/pages/_app.js" as="script"/><link rel="preload" href="/next-blog/_next/static/CA1RmOMAWSlZaodAgWHti/pages/_error.js" as="script"/><link rel="preload" href="/next-blog/_next/static/runtime/webpack-bf0647fcc5634d05e2c1.js" as="script"/><link rel="preload" href="/next-blog/_next/static/chunks/commons.fe83b0699cc115d8f2f1.js" as="script"/><link rel="preload" href="/next-blog/_next/static/runtime/main-8c21d63e457d27dcf8e4.js" as="script"/><style id="__jsx-3241352696">div#__next{height:100%;}</style><style id="__jsx-821146791">a.jsx-821146791{margin-right:30px;font-size:20px;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;color:rgba(0,0,0,0.7);}</style><style id="__jsx-1769670723">header.jsx-1769670723{box-shadow:0 0 1px rgba(0,0,0,0.2);-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;}
.header-container.jsx-1769670723{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 auto;padding-top:20px;max-width:1000px;padding-bottom:20px;}
div.slogan.jsx-1769670723{display:inline-block;font-weight:bold;font-size:24px;font-family:"Oswald",sans-serif;}
a.jsx-1769670723{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;color:rgba(0,0,0,0.7);}</style><style id="__jsx-1755787817">.card.jsx-1755787817{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-top:10px;padding-bottom:15px;height:200px;width:100%;margin-right:40px;}
.post-overview.jsx-1755787817{padding-top:0;padding-bottom:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}
.post-content.jsx-1755787817{overflow:hidden;line-height:23px;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:5;white-space:pre-wrap;-webkit-box-orient:vertical;}
.post-title.jsx-1755787817{font-size:24px;}
.read-more.jsx-1755787817{font-size:12px;}
a.jsx-1755787817{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;color:rgba(0,0,0,0.7);}
a.jsx-1755787817:hover{color:blue;opacity:0.6;cursor:pointer;}</style><style id="__jsx-1081340487">ul{padding:0;}
.card-container{box-shadow:0 2px 1px -2px rgba(0,0,0,0.2);}
.card-container:last-child{box-shadow:0 2px 1px -2px rgba(0,0,0,0);}
li{list-style:none;}</style><style id="__jsx-3119355585">.jsx-3119355585{text-align:center;}
.page-number.jsx-3119355585{margin-right:15px;}
.page-number.jsx-3119355585:nth-child(2){cursor:text;}
.page-number.jsx-3119355585:nth-child(2):hover{color:black;}</style><style id="__jsx-1395599585">.sidebar-title.jsx-1395599585{padding-bottom:10px;font-size:large;box-shadow:0 2px 1px -2px rgba(0,0,0,0.2);}
.sidebar-tag.jsx-1395599585{padding-top:10px;}
a.jsx-1395599585{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;color:rgba(0,0,0,0.7);}</style><style id="__jsx-3163762700">.home-container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-top:20px;}
.content-with-pagination{margin-right:100px;}
.post-list-container{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;}
.sidebar-container{min-width:150px;}</style><style id="__jsx-1732950521">.footer-container.jsx-1732950521{height:40px;margin-top:40px;background-color:black;}
.footer-content.jsx-1732950521{color:white;max-width:1000px;font-family:"Oswald",sans-serif;margin:10px auto;line-height:1.5;}
a.jsx-1732950521{margin-left:5px;color:white;}</style><style id="__jsx-2994019239">.jsx-2994019239{font-family:"Open Sans","Roboto","Microsoft YaHei","微软雅黑",STXihei, "华文细黑",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:auto;}
.content-container.jsx-2994019239{margin-top:50;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}
.content.jsx-2994019239{margin:0 auto;max-width:1000px;height:100%;min-height:650px;}</style><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans:300,400,500" class="jsx-3241352696"/><link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet" class="jsx-3241352696"/><link href="/static/dracula.css" rel="stylesheet" class="jsx-3241352696"/><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js" class="jsx-3241352696"></script><script class="jsx-3241352696">hljs.initHighlightingOnLoad();</script></head><body style="height:100%;margin:0" class="jsx-3241352696"><div id="__next"><div class="jsx-2994019239"><header class="jsx-1769670723"><div class="jsx-1769670723 header-container"><div class="jsx-1769670723 slogan"><a class="jsx-1769670723" href="/next-blog/page/?cur=1">Star Boy</a></div><div class="jsx-821146791"><a class="jsx-821146791" href="/next-blog/page/">Home</a><a class="jsx-821146791" href="/next-blog/about/">About</a></div></div></header><div class="jsx-2994019239 content-container"><div class="jsx-2994019239 content"><div class="jsx-3163762700 home-container"><div class="jsx-3163762700 content-with-pagination"><div class="jsx-1081340487 post-list-container"><ul class="jsx-1081340487"><div class="jsx-1755787817 card-container"><div class="jsx-1755787817 card"><div class="jsx-1755787817 post-overview"><a class="jsx-1755787817 post-title" href="/next-blog/post/react-native-at-airbnb-2/"> [翻译]Airbnb 的 React Native 实践： 技术细节</a><div class="jsx-1755787817 post-content">一些技术上的细节这是 Airbnb 关于 React Native 经验分享和移动端未来计划系列文章的第二篇.在 Android, iOS, web 和跨平台框架中,React Native 是一个全新的,快速发展的平台. 在两年后,我们可以肯定地说 React Native 在很多方面都是革命性的.React Native 对移动开发时一种范式转移,我们从中收获了许多,但是随之而来的还有一些明显的痛点.React Native 最主要的优点就是代码可以同时在 Android 和 iOS 上运行.大多数用 React Native 完成的功能可以达到 95%-100%的代码共享率,只有 0.2%的文件需要指定平台的(.android.js/ .ios.js).我们开发了一种跨平台的设计语言DLS. 每个组件都有 Android, iOS, React Native 和 web 版本.拥有一个统一的设计语言对于开发跨平台功能是十分必要的,因为这样可以保证不同平台间的设计,组件名和页面的一致性. 然而,我们仍然可以根据平台特征对不同平台做出更合理的的决策. 例如, 我们在 Android 上使用了原生的Toolbar,在 iOS 上使用了UINavigationBar, 并且由于不符合 An</div><a class="jsx-1755787817 read-more" href="/next-blog/post/react-native-at-airbnb-2/">Read more</a></div></div></div><div class="jsx-1755787817 card-container"><div class="jsx-1755787817 card"><div class="jsx-1755787817 post-overview"><a class="jsx-1755787817 post-title" href="/next-blog/post/react-native-at-airbnb-1/"> [翻译]Airbnb 的 React Native 实践： 概述</a><div class="jsx-1755787817 post-content">在 2016 年,我们在 React Native 上押了很多赌注.两年后,我们将分享我们的经验和下一步的计划.这是 Airbnb 关于 React Native 经验分享和移动端未来计划系列文章的第一篇.在十年前 Airbnb 刚刚发布的时候,智能手机刚刚起步.从那以后,智能手机已经变成我们日常生活中的一个重要工具了,特别是随着环球旅行的人数越来越多.对于一个为数百万人提供全新旅游形式的团体,一个世界级的移动 App 是必须的.当离开了家之后,移动设备通常是他们主要的或者唯一的通信形式.从 2008 年最初住进劳施街的三位旅客开始,移动端的年均使用量已经从零增长到了百万级别.我们的 App 可以使租主随时随地地管理房屋, 并在指尖为旅行者提供探索新地点和经历的灵感.为了追赶发展速度不断加快的移动设备,我们不断扩张我们的团队,现在已经有超过 100 位移动工程师,他们主要负责开发新功能和优化现有功能.我们持续的评估新技术来提高 Airbnb 上租主和租客的使用体验、高效开发、保持良好开发体验.在 2016 年, 我们对包括 React Native 在内的一系列技术进行了评估.当时, 我们意识到了移动端对我们业务的重要性,但是我们的移动开发工程师太少了,使得我们无法完成我们的目标.因此, 我们开始寻找替代方案.我们的网站主要是用 React 构建的.在 Airbnb 内部,React 是一个高效的,广受欢迎的框架.因此我们将 React Native 视为打开移动端开发的一个机会,同时利用跨平台的特性可以更快速的发布代码.在我们开始投入到 React Native 开发中时, 就意识到了风险的存在. 我们把一个全新的,快速迭代的,未经验证的平台添加到了我们的代码库中,这有可能会造成分裂而非统一.我们还意识到了要以一种正确的方式来投入到 React Native 开发中.针对 React Native, 我们的目标是:1.</div><a class="jsx-1755787817 read-more" href="/next-blog/post/react-native-at-airbnb-1/">Read more</a></div></div></div></ul></div><div class="jsx-3119355585"><a class="jsx-3119355585 page-number" href="/next-blog/page/1/">1</a><a class="jsx-3119355585 page-number" href="/next-blog/page/2/">2</a></div></div><div class="jsx-1395599585 sidebar-container"><div class="jsx-1395599585 sidebar-title">Tags:</div><div class="jsx-1395599585 sidebar-tag"><a class="jsx-1395599585" href="/next-blog/tags/Redux/">Redux  (2)</a></div><div class="jsx-1395599585 sidebar-tag"><a class="jsx-1395599585" href="/next-blog/tags/React-Native/">React-Native  (5)</a></div><div class="jsx-1395599585 sidebar-tag"><a class="jsx-1395599585" href="/next-blog/tags/React/">React  (1)</a></div></div></div></div></div><footer style="flex:0 0 auto" class="jsx-1732950521"><div class="jsx-1732950521 footer-container"><div class="jsx-1732950521 footer-content">© 2018 Yingjian Li. Powered by:<a href="https://nextjs.org/" class="jsx-1732950521">Next.js</a>. Inspired by<a href="https://github.com/frostfan/hexo-theme-polarbear" class="jsx-1732950521">Polar Bear</a></div></div></footer></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{"posts":[{"key":"react-native-at-airbnb-2","content":"| date       | tag          |\n| ---------- | ------------ |\n| 2018-07-19 | React-Native |\n\n---\n\n# [翻译]Airbnb 的 React Native 实践： 技术细节\n\n\u003e 一些技术上的细节\n\n_这是 Airbnb 关于 React Native 经验分享和移动端未来计划系列文章的第二篇._\n\n在 Android, iOS, web 和跨平台框架中,React Native 是一个全新的,快速发展的平台. 在两年后,我们可以肯定地说 React Native 在很多方面都是革命性的.React Native 对移动开发时一种[范式转移](https://en.wikipedia.org/wiki/Paradigm_shift),我们从中收获了许多,但是随之而来的还有一些明显的痛点.\n\n## React Native 的优点\n\n### 跨平台\n\nReact Native 最主要的优点就是代码可以同时在 Android 和 iOS 上运行.大多数用 React Native 完成的功能可以达到 95%-100%的代码共享率,只有 0.2%的文件需要指定平台的(_.android.js/ _.ios.js).\n\n### 统一的设计语言系统(DLS)\n\n我们开发了一种跨平台的设计语言[DLS](https://airbnb.design/building-a-visual-language/). 每个组件都有 Android, iOS, React Native 和 web 版本.拥有一个统一的设计语言对于开发跨平台功能是十分必要的,因为这样可以保证不同平台间的设计,组件名和页面的一致性. 然而,我们仍然可以根据平台特征对不同平台做出更合理的的决策. 例如, 我们在 Android 上使用了原生的[Toolbar](https://developer.android.com/reference/android/support/v7/widget/Toolbar),在 iOS 上使用了[UINavigationBar](https://developer.apple.com/documentation/uikit/uinavigationbar), 并且由于不符合 Android 平台设计规范的原因,我们在 Android 上隐藏了[扩展指示器](https://developer.apple.com/ios/human-interface-guidelines/views/tables/).\n\n我们选择重写组件,而不是封装原生组件.因为分离特定平台的 API 是一种更可靠的方式, 这样可以减少 Android 工程师和 iOS 工程师再不熟悉 React Native 情况下的维护成本. 然而,这样确实会导致同一组件在原生平台和 React Native 之间的碎片不同步.\n\n### React\n\nReact 被大家喜爱是有[原因](https://insights.stackoverflow.com/survey/2018/#technology-most-loved-dreaded-and-wanted-frameworks-libraries-and-tools)的,不但操作简单,而且功能强大,扩展性强.React 中我们最喜欢的是:\n\n- **组件**: React 中的组件通过`props`和`state`加强了关注分离,这使得 React 具有可扩展性.\n- **简化的生命周期**: 众所周知, Android 和 iOS(稍好于 Android)上的生命周期是十分复杂的. React 组件跟本地解决了这个问题,这也使得学习 React Native 比学习 Android 和 iOS 简单得多.\n- **声明式**: React 的声明式特性使我们能同步 UI 与 state.\n\n### 迭代速度\n\n当我们在开发 React Native 时, 利用[热加载](https://facebook.github.io/react-native/blog/2016/03/24/introducing-hot-reloading.html)特性,只需要 1-2 秒就可以在 Android 和 iOS 上测试我们的改动. 尽管构建性能在原生 App 中拥有最高的优先级,但从来没有达到过 React Native 中的迭代速度.最好情况下,原生的编译时间需要 15 秒.但是完整的构建需要长达 20 分钟.\n\n### 投资基础设施\n\n我们做了大量的与原生基础设施集成的工作.所有的核心部分(如网络,国际化,实验,共享元素转换,设备信息,账号信息)和一些其他部分都被封装在了单独的 React Native 的 API 中.因为我们希望把现有的 Android 和 iOS 的 API 封装成具有规范性和一致性的模块暴露给 React,所以这部分桥接工作会更复杂一点.虽然随着快速迭代和新基础设施的开发,需要不断地更新这些桥接中间层，但基础设施团队的投入使产品工作变得更加容易.\n\n如果不在基础设施上大量投资的话,React Native 会降低开发体验和用户体验.因此,我们认为引入 React Native 到一个成熟的 App 中,需要不断地有效地投入.\n\n### 性能\n\nReact Native 最大的隐患就是它的性能.然而我们在实践中这几乎算不上是问题.大多数的 React Native 页面和原生一样流畅. 通常情况下,我们都是从单一维度来考虑性能问题.经常会有移动开发工程师看到 JS 代码会有\"比 Java 慢\"的感觉.然而在很多情况下,将业务逻辑和布局抽出主线程会提高渲染的性能.\n\n我们遇到的性能问题大多是由过多的渲染引起的,[`shouldComponentUpdate`](https://reactjs.org/docs/react-component.html#shouldcomponentupdate),[`removeClippedSubviews`](https://facebook.github.io/react-native/docs/view.html#removeclippedsubviews)和更好的使用`Redux`可以帮助我们缓和性能问题.\n\n然而,初始化和第一次的渲染时间使得 React Native 在启动画面,深度链接时的性能较差,而且在页面间导航的 TTI(Time to iteract)会较长.此外,页面掉帧也很难 debug,因为 React Native 和原生视图间的转换是由[Yoga](https://github.com/facebook/yoga)负责的.\n\n### Redux\n\n我们使用[Redux](https://redux.js.org/)来高效地管理`state`,避免 UI 的 state 不同步,方便页面间共享数据.然而,Redux 中的模板代码却一直被人诟病,而且学习曲线较难.虽然我们提供了一些通用模板的生成器,但是在使用 React Native 时, 它仍是最有挑战性和最容易产生混淆的部分.不过值得注意的是,这些问题并不是 React Native 特有的.\n\n### 原生支持\n\n由于 React Native 中的所有内容都能桥接到原生代码,因此最后我们实现了许多最开始不确定能否实现的功能,如:\n\n1.  _共享元素变换(Shared element transitions)_: 我们构建了一个支持原生 Android 和 iOS 上共享元素代码的`\u003cSharedElement\u003e`组件,甚至在 React Native 页面间也通用.\n2.  _Lottie_:我们在 Android 和 iOS 上封装现有的库,使 Lottie 支持 React Native.\n3.  原生网络栈: 在 Android 和 iOS 上,React Native 使用了我们现有的原生网络栈和缓存.\n4.  其他核心基础设施:像网络一样,我们还封装了其他现有原生基础设施,如国际化,实验等,以便无缝地在 React Native 上开展工作.\n\n### 静态分析\n\n我们本可以利用在 web 端使用`ESLint`的大量经验,但我们 Aibnb 中第一个使用`prettier`的平台.我们发现它可以有效地减少 PR 上的小问题以及琐碎的争论.`prettier`现在已经开始被使用到 web 基础设施团队中了.\n\n我们还使用分析来衡量渲染次数和性能,以找出具有性能问题的高优先级页面.\n\n相较于我们的 web 基础设施,React Native 小而新,因此适合试验许多新想法. 我们在 React Native 上创建的许多工具和想法已经推广到 web 端了.\n\n### 动画\n\n感谢 React Native [Animated](https://facebook.github.io/react-native/docs/animated.html)库, 我们才能实现无抖动的动画,甚至是交互驱动的动画,如滚动视差.\n\n### JS/React 开源\n\n因为 React 确实在运行`React`和`Javascript`, 我们可以利用大量 javacript 的工程,如`redux`,`reselect`,`jest`等.\n\n### Flexbox\n\nReact Native 通过[Yoga](https://github.com/facebook/yoga)处理布局.Yoga 是一个通过[flexbox](https://www.w3schools.com/css/css3_flexbox.asp)API 处理布局计算的跨平台 C++库.我们在早期使用 Yoga 时,遇到了缺乏宽高比等不足,但已经在后续的更新中解决了.此外,有趣的教程(如[flexboxfroggy](https://flexboxfroggy.com/))使得入门变得更加的有趣.\n\n### 与 web 端合作\n\n在后面使用 React Native 时,我们开始一次性构建 web,iOS 和 android,因为 web 端也同样使用`Redux`, 我们发现许多代码不需要更改就可以在 web 和原生平台间跨平台分享.\n\n## 不足\n\n### React Native 还不够成熟\n\nReact Native 远不如 Android 和 iOS 成熟.它是一门新技术,但野心勃勃,发展极其迅速.尽管 React Native 在大多数场合下都表现得十分出色,但也在某些地方表现的并不成熟,而且使得一些原生中的小功能变得十分复杂.不幸的是,很难预测什么时候会遇到这种问题,而且需要多长时间来解决这些问题(也许几个小时,也许几天).\n\n### 维护 React Native 的 fork\n\n由于 React Native 的不成熟,很多时候我们需要修补 React Native 的源码.除了贡献给 React Native 外, 我们还必须[维护一个 fork](https://github.com/airbnb/react-native/commits/0.46-canary)来快速的合并改动,升级我们的版本.在两年内,我们不得不在 React Native 添加大概 50 多条提交.这使得升级 React Native 的过程变得十分痛苦.\n\n### javascript 工具\n\nJavascript 是一门无类型语言,缺少安全性既不易扩展,又成为了那些习惯了类型语言,对 React Native 感兴趣的的移动工程师们争论的焦点. 我们尝试采用[`flow`](https://flow.org/),但是晦涩难懂的错误信息使得开发体验大幅度下降.我们还尝试了[`TypeScript`](http://www.typescriptlang.org/),但在与现有基础设施(如[`babel`](https://babeljs.io/)和[`metro bundler`](https://github.com/facebook/metro))的集成时却出现了问题.尽管如此,我们在 web 端会继续使用`TypeScript`.\n\n### 重构\n\nJavaScript 无类型的一个副作用就是重构会变得十分困难,而且容易出错.重命名 props 时,尤其像`onClick`这种常见 props 或者传到多个组件中的 props,想要准确地对他们进行重命名简直就是噩梦.更糟的情况是, 重构可能会破坏生产环境而不是编译过程,而且很难添加适当的静态分析规则.\n\n### JavaScript 核心环境不一致\n\nReact Native 一个微妙而棘手的问题是由[JavaScript 核心环境](https://facebook.github.io/react-native/docs/javascript-environment.html)引起的.下面是我们得出的结论:\n\n- iOS 将 JavaScript 核心环境[开箱即用](https://developer.apple.com/documentation/javascriptcore),因此 iOS 具有一致性而且不会出现问题.\n- Android 中没有 JavaScript 核心环境,所以 React Native 需要自己打包,但默认的是[老版本](https://github.com/facebook/react-native/issues/10245). 因此我们必须打包一个[新版本](https://github.com/react-community/jsc-android-buildscripts).\n- 在 Debug 时,React Native 依赖于强大 Chrome 开发者工具.然而在 debug 时,所有的 JavaScript 都运行在 Chrome 的 V8 引擎当中.这在 99.9%的情况下都不会出现问题.但是,我们发现`toLocaleString`在 iOS 和 debug 模式下的 Android 正常运行.事实证明 Android 的 JSC 中不包含该方法,它会默默的失败,除非你是在 debug 模式下.如果没有类似的经验,debug 类似问题将会十分痛苦.\n\n### React Native 开源库\n\n学习一个平台是十分困难而且耗时的.大多数人只熟悉一到两个平台.包含原生桥接的 React Native 库(如地图,视频等)需要三个平台的知识.我们发现大多数的 React Native 开源项目的作者都只精通一到两个平台.这会导致 Android 和 iOS 的不一致性或意想不到的 bug.\n\n在 Android 上,许多的 React Native 库还需要使用`node_modules`的相对路径, 而不是像社区期望的那样利用 maven 发布工件.\n\n### 并行的基础设施\n\n我们已经在 Android 和 iOS 的原生基础设施上累计了许多年的经验.然而对于 React Native 我们是从零开始,因此我们需要完成许多与已有基础设施的桥接工作.这意味着许多时候一个产品工程师会需要一个还不存在的功能.这时他们要么在他们不熟悉的平台中开发范围外的功能,或者被阻塞,直到桥接工作的完成.\n\n### 崩溃监控\n\n我们使用[`Bugsnag`](https://www.bugsnag.com/)监控 Android 和 iOS 上的崩溃记录.尽管我们能使`Bugsnag`在所有平台上正常工作,但相比于其他平台,他并不十分可靠而且需要更多工作量.因为 React Native 是一门相当新的技术,而且工业中使用较少,我们不得不构建大量的基础设施(如内部上传 source map), 还必须使`Bugsnag`能够过滤出那些发生在 React Native 上的崩溃信息.\n\n由于 React Native 中大量自定义基础设施的存在,我们有时遇到一些无法正常收到崩溃报告或 source map 没有正确上传的问题.\n\n最后,调试 React Native 崩溃通常是十分困难的,如果 bug 涉及 React Native 和原生代码,调用堆栈不会从 React Native 跳到 native.\n\n### 原生桥接\n\nReact Native 有一个[`桥接 API`](https://facebook.github.io/react-native/docs/communication-ios.html)可以在 React Native 和 native 间通信. 你需要写大量繁琐的代码来使它正常工作.首先它需要正确的设置所有的三种开发环境.我们还遇到过许多类型问题,例如整数类型通常会被封装成字符串,直到它通过桥接器时,我们才注意到这个问题.更严重的情况下, iOS 会默默失败而 Android 会崩溃.从 2017 年年底开始,我们开始研究自动生成 TypeScript 定义的桥接代码,但为时已晚.\n\n### 初始化时间\n\n在 React Native 第一次渲染之前,我们必须初始化运行时,不幸的是,像我们这种大小的 App,即使在高端机上也需要花费几秒的时间.因此,React Native 几乎不可能用来做启动页面. 我们通过在 app 启动时初始化的方式,减少 React Native 的初次渲染时间.\n\n### 初始渲染时间\n\n与原生页面不同,渲染 React Native 至少需要经历主线程-\u003ejs-\u003eyoga 布局线程-\u003e主线程的过程,才能有足够的信息完成第一次的页面渲染.我们观察平均初始渲染时间,iOS 需要 280ms,Android 需要 440ms.在 Android 上,我们使用通常被用在共享元素变化的[`postponeEnterTransition`](https://developer.android.com/reference/android/app/Activity.html#postponeEnterTransition%28%29)API,在渲染完成之后延迟展示页面.iOS 上,我们在加速 React Native 的导航栏配置时遇到了问题.因此我们为所有的 React Native 页面转换加了 50ms 的人造延迟, 避免配置完成后导航栏的闪烁.\n\n### App 大小\n\nReact Native 对 app 的大小有着不可忽视的影响.在 Android 上 React Native(Java + JS + Yoga 等原生库 native + JavaScript 运行时)的总大小为 8mb/ABI. 加上 apk 中的 x86 和 arm(32 位),大小会达到将近 12mb.\n\n### 64 位\n\n由于[这个](https://github.com/facebook/react-native/issues/2814)问题,我们仍然无法在 Android 上使用 64 位的 APK.\n\n### 手势\n\n我们避免在需要复杂手势的页面上使用 React Native,因为 Android 和 iOS 的触屏子系统不同,所以 React Native 社区很难得到一个统一的 API.然而,随着[`react-native-gesture-handler`](https://github.com/kmagiera/react-native-gesture-handler)1.0 的发布,这部分工作也将持续地取得进展.\n\n### 长列表\n\nReact Native 已经在这方面取得了一定的进展([`FlatList`](https://facebook.github.io/react-native/docs/flatlist.html)),但是还远远达不到 Android[`RecyclerView`](https://developer.android.com/guide/topics/ui/layout/recyclerview)和 iOS[`UICollectionView`](https://developer.apple.com/documentation/uikit/uicollectionview)的成熟度和灵活性.由于线程处理的问题,许多问题很难被解决.由于适配器数据无法同步访问,因此在快速滑动时可能会出现页面因异步渲染而闪烁的情况.文本也无法同步的测量,因此 iOS 上无法根据预先计算好的高度进行特定的优化.\n\n### 升级 React Native\n\n尽管大多数情况下,升级 React Native 版本都是微不足道的,但有时却是十分痛苦的.特别是因为使用了 React 16 的 alpha 和 beta 版本,React Native 0.43(2017.4)到 React Native 0.49(2017.10)间的版本几乎都是不可用的.这是一个很大的问题,因为大多数 web 端的 React 库都不支持预发布的 React 版本.在 2017 年年中,关于这次升级依赖关系的争吵对 React Native 的基础设施造成了巨大的伤害.\n\n### Accessibility\n\n2017 年我们对 Accessibility 进行了一次改革,投入了大量的资源以确保残疾人也能够使用 Airbnb 根据自身需求预定房源. 然而 React Native 的可访问性 API 中存在着许多问题.为了实现最简单的可访问栏,我们不得不维护自己的 React Native [fork](https://github.com/airbnb/react-native/commits/0.46-canary). 对于这些情况,可能在 Android 和 iOS 上只需要一行的修改,但我们需要花费几天的时间来考虑如何把它添加到 React Native 中, cherry pick,填到 React Native 的 issue 中,并在接下来的几个星期里持续关注该 issue.\n\n### 令人厌烦的崩溃\n\n我们曾经不得不解决一些非常奇怪的,很难修复的崩溃.例如,我们现在遇到的这个`@ReactProp`的[问题](https://issuetracker.google.com/issues/37045084),在任何设备上都无法重现,即使与崩溃设备完全相同的软硬件也不行.\n\n### Android 上跨进程的 SavedInstanceState\n\nAndroid 会频繁地清理后台进程, 但可以[同步地把 state 存储到 bundle 中](https://developer.android.com/topic/libraries/architecture/saving-states#use_onsaveinstancestate_as_backup_to_handle_system_initiated_process_death).但是对于 React Native 来说, 所有的 state 都在 js 线程中,无法完成同步存储.即便使用 redux 存储 state 也不行.因为它包含了序列化和非序列化的数据以及其他符合 savedInstanceState bundle 的数据,可能会导致产品环境的崩溃.\n\n---\n\n_这是 Airbnb 关于 React Native 经验分享和移动端未来计划系列文章的第二篇._\n\n[第一篇: React Native at Airbnb](../react-native-at-airbnb-1)\n\n[第二篇: The Technology](../react-native-at-airbnb-2)\n\n[第三篇: Building a Cross-Platform Mobile Team](../react-native-at-airbnb-3)\n\n[第四篇: Making a Decision on React Native](../react-native-at-airbnb-4)\n\n[第五篇: What's Next for Mobile](../react-native-at-airbnb-5)\n\n- 原文地址：https://medium.com/airbnb-engineering/react-native-at-airbnb-the-technology-dafd0b43838\n- 译文出自：TWNTF\n- 译者：Yingjian Li\n"},{"key":"react-native-at-airbnb-1","content":"| date       | tag          |\n| ---------- | ------------ |\n| 2018-07-18 | React-Native |\n\n---\n\n# [翻译]Airbnb 的 React Native 实践： 概述\n\n\u003e 在 2016 年,我们在 React Native 上押了很多赌注.两年后,我们将分享我们的经验和下一步的计划.\n\n_这是 Airbnb 关于 React Native 经验分享和移动端未来计划系列文章的第一篇._\n\n在十年前 Airbnb 刚刚发布的时候,智能手机刚刚起步.从那以后,智能手机已经变成我们日常生活中的一个重要工具了,特别是随着环球旅行的人数越来越多.对于一个为数百万人提供全新旅游形式的团体,一个世界级的移动 App 是必须的.当离开了家之后,移动设备通常是他们主要的或者唯一的通信形式.\n\n从 2008 年最初住进劳施街的三位旅客开始,移动端的年均使用量已经从零增长到了百万级别.我们的 App 可以使租主随时随地地管理房屋, 并在指尖为旅行者提供探索新地点和经历的灵感.\n\n为了追赶发展速度不断加快的移动设备,我们不断扩张我们的团队,现在已经有超过 100 位移动工程师,他们主要负责开发新功能和优化现有功能.\n\n## 下注 React Native\n\n我们持续的评估新技术来提高 Airbnb 上租主和租客的使用体验、高效开发、保持良好开发体验.在 2016 年, 我们对包括 React Native 在内的一系列技术进行了评估.当时, 我们意识到了移动端对我们业务的重要性,但是我们的移动开发工程师太少了,使得我们无法完成我们的目标.因此, 我们开始寻找替代方案.我们的网站主要是用 React 构建的.在 Airbnb 内部,React 是一个高效的,广受欢迎的框架.因此我们将 React Native 视为打开移动端开发的一个机会,同时利用跨平台的特性可以更快速的发布代码.\n\n在我们开始投入到 React Native 开发中时, 就意识到了风险的存在. 我们把一个全新的,快速迭代的,未经验证的平台添加到了我们的代码库中,这有可能会造成分裂而非统一.我们还意识到了要以一种正确的方式来投入到 React Native 开发中.针对 React Native, 我们的目标是:\n\n1.  可以在组织层面提高开发效率.\n2.  维持 native 设定的质量标准.\n3.  利用 React Native 的跨平台特性,只写一次移动端的代码.\n4.  提升开发体验.\n\n## 我们的经历\n\n在过去的两年里, 我们不断认真努力的工作,进行试验,完成了不可思议的工作.我们将 React Native 紧密的集成到了我们的 App 中, 还实现了复杂的 native 功能,如共享元素动画,视差,地理围栏以及与现有 native 基础设施(网络,实验,国际化)的桥接工作.\n\n我们通过 React Native 已经发布了许多重要的产品, 从评论到礼物卡,还包括全新的[Experiences(体验)](https://www.airbnb.com/s/experiences)功能.许多功能都是在我们没有足够的 native 工程师的情况下完成的.\n\n不同的团队在 React Native 方面拥有广泛的经验。React Native 有时表现得十分出色,而有时会造成一些技术上和组织上的问题. 在本系列文章中, 我们详细介绍了我们的经验以及我们接下来的计划。\n\n[第二部分](../react-native-at-airbnb-2)中, 我们列举了技术方面上 React Native 优点和缺陷.\n\n[第三部分](../react-native-at-airbnb-3)中, 我们列举了在构建跨平台移动端团队中的组织方面的问题\n\n[第四部分](../react-native-at-airbnb-4)中, 我们重点展示了我们对 React Native 的看法以及 Airbnb 未来的发展方向.\n\n[第五部分](../react-native-at-airbnb-5)中, 利用我们在 React Native 上积累的经验,使原生变得更好.\n\n- 原文地址：https://medium.com/airbnb-engineering/react-native-at-airbnb-f95aa460be1c\n- 译文出自：TWNTF\n- 译者：Yingjian Li\n"}],"filteredPosts":[{"key":"goodbye-redux","title":"[翻译]再见了, Redux","tag":["Redux"],"date":"2018-09-18"},{"key":"react-native-at-airbnb-4","title":"[翻译]Airbnb 的 React Native 实践： 弃用 React Native","tag":["React-Native"],"date":"2018-08-14"},{"key":"react-native-at-airbnb-5","title":"[翻译]Airbnb 的 React Native 实践： 移动端发展计划","tag":["React-Native"],"date":"2018-08-11"},{"key":"redux-vs-context-api","title":"对比 Redux 和 Context API","tag":["React","Redux"],"date":"2018-07-26"},{"key":"react-native-at-airbnb-3","title":"[翻译]Airbnb 的 React Native 实践： 构建一个跨平台的移动端团队","tag":["React-Native"],"date":"2018-07-25"},{"key":"react-native-at-airbnb-2","title":"[翻译]Airbnb 的 React Native 实践： 技术细节","tag":["React-Native"],"date":"2018-07-19"},{"key":"react-native-at-airbnb-1","title":"[翻译]Airbnb 的 React Native 实践： 概述","tag":["React-Native"],"date":"2018-07-18"}]}},"page":"/page","pathname":"/page","query":{"cur":2,"pageCount":2},"buildId":"CA1RmOMAWSlZaodAgWHti","assetPrefix":"/next-blog","runtimeConfig":{"backendUrl":"/next-blog"},"nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/page" src="/next-blog/_next/static/CA1RmOMAWSlZaodAgWHti/pages/page.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/next-blog/_next/static/CA1RmOMAWSlZaodAgWHti/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/next-blog/_next/static/CA1RmOMAWSlZaodAgWHti/pages/_error.js"></script><script src="/next-blog/_next/static/runtime/webpack-bf0647fcc5634d05e2c1.js" async=""></script><script src="/next-blog/_next/static/chunks/commons.fe83b0699cc115d8f2f1.js" async=""></script><script src="/next-blog/_next/static/runtime/main-8c21d63e457d27dcf8e4.js" async=""></script></body></html>